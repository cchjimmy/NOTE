(()=>{(function(){let a=document.querySelector("#list"),f=document.querySelector("#content"),h=document.querySelector("#new-note"),D=document.querySelector("#remove-note"),T=document.querySelector("#save-note"),N=document.querySelector("#change-title"),d=document.querySelector("dialog"),k=d.querySelector("#confirm-title"),s=d.querySelector("#new-title"),M=document.querySelector("#sidebar-toggle"),q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=[],v=[],I=[];var m=!1;J(i),b(i),O(i);var o;o=i[0]??=g(),S(o),c(o).classList.add("active-note"),h.onclick=e=>{e.preventDefault();let t=g();i.unshift(t),a.insertAdjacentElement("afterbegin",c(t))},D.onclick=e=>{e.preventDefault();for(let t=0;t<i.length;++t)if(i[t].id==o.id){v.push(i.splice(t,1)[0]);break}$(o),p(o),A(o),o=i[0]??=g(),c(o),y(o),m=!0},T.onclick=e=>{e.preventDefault(),L(o),b(i),a.insertAdjacentElement("afterbegin",c(o))},N.onclick=e=>{e.preventDefault(),d.showModal(),s.value=o.title},k.onclick=e=>{e.preventDefault(),d.close(),o.title!=s.value&&(o.modified=!0,E(o,s.value)),s.value=null},M.onclick=e=>{e.preventDefault(),a.style.display=a.style.display=="block"?"none":"block"};let w=H(()=>{o.content=f.innerHTML});new MutationObserver(()=>{if(w(),!o.modified){if(m){m=!1;return}o.modified=!0,c(o)}}).observe(f,{characterData:!0,subtree:!0,childList:!0});function c(e){let t=document.getElementById(e.id);t||(t=document.createElement("li"),a.insertAdjacentElement("afterbegin",t)),t.style.display="block",t.id=e.id,t.classList.add("outlined");let n=new Date(e.time),l=n.getMinutes(),r=n.getSeconds(),u=n.getHours();return t.innerHTML=`${e.modified?"*":""}${e.title}<br>${n.getFullYear()}-${q[n.getMonth()]}-${n.getDate()}<br>${u<10?"0"+u:u}:${l<10?"0"+l:l}:${r<10?"0"+r:r}`,t.onclick=()=>{p(o),y(e),o=e,m=!0},t}function E(e,t){e.title=t,c(e)}function P(e,t=300){let n=!1,l;function r(){n=!1,l&&(n=!0,e(...l),l=null,setTimeout(r,t))}return(...u)=>{l=u,!n&&(e(...u),n=!0,setTimeout(r,t))}}function H(e,t=300){let n;return(...l)=>{clearTimeout(n),n=setTimeout(()=>e(...l),t)}}function W(){return document.getSelection()}function L(e){e.time=new Date().getTime(),e.modified=!1,e.content=e.content,localStorage.setItem(e.id,JSON.stringify(e))}function g(){let e=v.pop()??{};return e.title="New note",e.id??=I.pop()??B(),e.time=new Date().getTime(),e.content="",e.modified=!1,e}function $(e){localStorage.removeItem(e.id)}function Y(e,t){t.title=e.title,t.content=e.content,t.time=e.time,t.modified=e.modified}function x(e){document.getElementById(e.id).remove()}function A(e){document.getElementById(e.id).style.display="none"}function B(){return parseInt(Math.random()*2**64)}function y(e){document.getElementById(e.id).classList.add("active-note"),S(e)}function p(e){document.getElementById(e.id).classList.remove("active-note")}function S(e){f.innerHTML=e.content}function J(e){e.splice(0);let t=localStorage.length;for(let n=0;n<t;++n)e[n]=JSON.parse(localStorage.getItem(localStorage.key(n)));return e}function O(e){let t=e.length;for(let n=t-1;n>=0;--n)c(e[n])}function b(e){return e.sort((t,n)=>n.time-t.time)}})();})();
