(()=>{var Y=(m=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(m,{get:(N,C)=>(typeof require<"u"?require:N)[C]}):m)(function(m){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+m+'" is not supported')});var Q=(m,N)=>()=>(N||m((N={exports:{}}).exports,N),N.exports);var X=Q((et,V)=>{(function(){function m(C,u){return u?Y(C):C.slice?m[A(C)]:function(b,D){C(b={exports:{}}),m[A(D)]=b.exports};function A(b){return b.split("/").slice(-1).toString().replace(".js","")}}if(typeof V<"u")var N=V;m(function(C){String.random=function(A,b){var D="";for(A=A||24,b=b||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";A-- >0;)D+=b.charAt(Math.floor(Math.random()*b.length));return D},String.match=function(A,b){var D,x;return typeof A!="string"?!1:(typeof b=="string"&&(b={"=":b}),b=b||{},D=b["="]||b["*"]||b[">"]||b["<"],A===D?!0:x!==b["="]?!1:(D=b["*"]||b[">"],A.slice(0,(D||"").length)===D?!0:x!==b["*"]?!1:x!==b[">"]&&x!==b["<"]?A>=b[">"]&&A<=b["<"]:x!==b[">"]&&A>=b[">"]||x!==b["<"]&&A<=b["<"]))},String.hash=function(A,b){if(typeof A=="string"){if(b=b||0,!A.length)return b;for(var D=0,x=A.length,O;D<x;++D)O=A.charCodeAt(D),b=(b<<5)-b+O,b|=0;return b}};var u=Object.prototype.hasOwnProperty;Object.plain=function(A){return A?A instanceof Object&&A.constructor===Object||Object.prototype.toString.call(A).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(A,b){for(var D in A)if(u.call(A,D)&&(!b||b.indexOf(D)==-1))return!1;return!0},Object.keys=Object.keys||function(A){var b=[];for(var D in A)u.call(A,D)&&b.push(D);return b},function(){var A,b=setTimeout,D=0,x=0,O=typeof setImmediate!=""+A&&setImmediate||function(r,c){return typeof MessageChannel==""+A?b:((r=new MessageChannel).port1.onmessage=function(g){g.data==""&&c()},function(g){c=g,r.port2.postMessage("")})}(),h=b.check=b.check||typeof performance!=""+A&&performance||{now:function(){return+new Date}};b.hold=b.hold||9,b.poll=b.poll||function(r){if(b.hold>=h.now()-D&&x++<3333){r();return}O(function(){D=h.now(),r()},x=0)}}(),function(){var A=setTimeout,b=A.turn=A.turn||function(c){D.push(c)==1&&x(r)},D=b.s=[],x=A.poll,O=0,h,r=function(){(h=D[O++])&&h(),(O==D.length||O==99)&&(D=b.s=D.slice(O),O=0),D.length&&x(r)}}(),function(){var A,b=setTimeout,D=b.turn;(b.each=b.each||function(x,O,h,r){r=r||9,function c(g,y,$){if(y=(g=(x||[]).splice(0,r)).length){for(var a=0;a<y&&A===($=O(g[a]));a++);if(A===$){D(c);return}}h&&h($)}()})()}()})(m,"./shim"),m(function(C){C.exports=function u(h,b,D){if(!h)return{to:u};var x,O=typeof b=="function",h=(this.tag||(this.tag={}))[h]||O&&(this.tag[h]={tag:h,to:u._={next:function(c){var g;(g=this.to)&&g.next(c)}}});if(O){var r={off:u.off||(u.off=function(){if(this.next===u._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=u._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:u._,next:b,the:h,on:this,as:D};return(r.back=h.last||h).to=r,h.last=r}return(h=h.to)&&x!==b&&h.next(b),h}})(m,"./onto"),m(function(C){C.exports=function(u){return u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"&&u!=1/0&&u!=-1/0&&u===u||!!u&&typeof u["#"]=="string"&&Object.keys(u).length===1&&u["#"]}})(m,"./valid"),m(function(C){m("./shim");function u(){var h=+new Date;return x<h?(b=0,x=h+u.drift):x=h+(b+=1)/D+u.drift}u.drift=0;var A=-1/0,b=0,D=999,x=A,O;u.is=function(h,r,c){var g=r&&h&&h._&&h._[">"]||c;if(g)return typeof(g=g[r])=="number"?g:A},u.ify=function(h,r,c,g,y){(h=h||{})._=h._||{},y&&(h._["#"]=y);var $=h._[">"]||(h._[">"]={});return O!==r&&r!=="_"&&(typeof c=="number"&&($[r]=c),O!==g&&(h[r]=g)),h},C.exports=u})(m,"./state"),m(function(C){m("./shim");function u(A){var b={s:{}},D=b.s;A=A||{max:999,age:1e3*9},b.check=function(O){return D[O]?x(O):!1};var x=b.track=function(O){var h=D[O]||(D[O]={});return h.was=b.now=+new Date,b.to||(b.to=setTimeout(b.drop,A.age+9)),x.ed&&x.ed(O),h};return b.drop=function(O){b.to=null,b.now=+new Date;var h=Object.keys(D);console.STAT&&console.STAT(b.now,+new Date-b.now,"dup drop keys"),setTimeout.each(h,function(r){var c=D[r];c&&(O||A.age)>b.now-c.was||delete D[r]},0,99)},b}C.exports=u})(m,"./dup"),m(function(C){m("./onto"),C.exports=function(b,D){if(this.on){var x=(this.opt||{}).lack||9e3;if(typeof b!="function"){if(!b)return;var h=b["#"]||b,O=(this.tag||"")[h];return O?(D&&(O=this.on(h,D),clearTimeout(O.err),O.err=setTimeout(function(){O.off()},x)),!0):void 0}var h=D&&D["#"]||u(9);if(!b)return h;var r=this.on(h,b,D);return r.err=r.err||setTimeout(function(){r.off(),r.next({err:"Error: No ACK yet.",lack:!0})},x),h}};var u=String.random||function(){return Math.random().toString(36).slice(2)}})(m,"./ask"),m(function(C){function u(y){return y instanceof u?(this._={$:this}).$:this instanceof u?u.create(this._={$:this,opt:y}):new u(y)}u.is=function(y){return y instanceof u||y&&y._&&y===y._.$||!1},u.version=.202,u.chain=u.prototype,u.chain.toJSON=function(){},m("./shim"),u.valid=m("./valid"),u.state=m("./state"),u.on=m("./onto"),u.dup=m("./dup"),u.ask=m("./ask"),function(){u.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||u.on,t.ask=t.ask||u.ask,t.dup=t.dup||u.dup();var n=t.$.opt(t.opt);return t.once||(t.on("in",y,t),t.on("out",y,t),t.on("put",j,t),u.on("create",t),t.on("create",t)),t.once=1,n};function y(t){if(t){if(t.out===y){this.to.next(t);return}var n=this,e=n.as,l=e.at||e,T=l.$,_=l.dup,d,G=t.DBG;if((d=t["#"])||(d=t["#"]=b(9)),!_.check(d)){if(_.track(d),d=t._,t._=typeof d=="function"?d:function(){},t.$&&t.$===(t.$._||"").$||(t.$=T),t["@"]&&!t.put&&f(t),!l.ask(t["@"],t))if(G&&(G.u=+new Date),t.put){$(t);return}else t.get&&u.on.get(t,T);G&&(G.uc=+new Date),n.to.next(t),G&&(G.ua=+new Date),!(t.nts||t.NTS)&&(t.out=y,l.on("out",t),G&&(G.ue=+new Date))}}}function $(t){if(t){var n=t._||"",e=n.root=((n.$=t.$||"")._||"").root;if(t["@"]&&n.faith&&!n.miss){t.out=y,e.on("out",t);return}n.latch=e.hatch,n.match=e.hatch=[];var l=t.put,T=n.DBG=t.DBG,_=+new Date;if(P=P||_,!(l["#"]&&l["."])){T&&(T.p=_),n["#"]=t["#"],n.msg=t,n.all=0,n.stun=1;var d=Object.keys(l);console.STAT&&console.STAT(_,((T||n).pk=+new Date)-_,"put sort");var G=0,I,E,S,M,J,W,H;(function L(R){if(I!=G){if(I=G,!(S=d[G])){console.STAT&&console.STAT(_,((T||n).pd=+new Date)-_,"put"),i(n);return}(M=l[S])?(H=M._)?S!==H["#"]?W=s+w(S)+"soul not same.":(J=H[">"])||(W=s+w(S)+"no state."):W=s+w(S)+"no meta.":W=s+w(S)+"no node.",E=Object.keys(M||{})}if(W){t.err=n.err=W,i(n);return}var F=0,U;for(R=R||0;R++<9&&(U=E[F++]);)if(U!=="_"){var K=M[U],z=J[U];if(r===z){W=s+w(U)+"on"+w(S)+"no state.";break}if(!x(K)){W=s+w(U)+"on"+w(S)+"bad "+typeof K+w(K);break}a(K,U,S,z,t),++k}if((E=E.slice(F)).length){D(L);return}++G,E=null,L(R)})()}}}u.on.put=$;function a(t,n,e,l,T){var _=T._||"",d=_.root,G=d.graph,I,E,S=G[e]||c,M=O(S,n,1),J=S[n],W=_.DBG;(E=console.STAT)&&(!G[e]||!J)&&(E.has=(E.has||0)+1);var H=o(),L;if(l>H){setTimeout(function(){a(t,n,e,l,T)},(E=l-H)>B?B:E),console.STAT&&console.STAT((W||_).Hf=+new Date,E,"future");return}if(!(l<M)&&!(!_.faith&&l===M&&(t===J||v(t)<=v(J))&&!_.miss)){_.stun++;var R=T["#"]+_.all++,F={toString:function(){return R},_};F.toJSON=F.toString,d.dup.track(F)["#"]=T["#"],W&&(W.ph=W.ph||+new Date),d.on("put",{"#":F,"@":T["@"],put:{"#":e,".":n,":":t,">":l},ok:T.ok,_})}}function j(t){var n;(n=(t._||"").DBG)&&(n.pa=+new Date,n.pm=n.pm||+new Date);var e=this,l=e.as,T=l.graph,_=t._,d=t.put,G=d["#"],I=d["."],E=d[":"],S=d[">"],M=t["#"],J;(J=_.msg)&&(J=J.put)&&(J=J[G])&&h(J,I,S,E,G),T[G]=h(T[G],I,S,E,G),(J=(l.next||"")[G])&&J.on("in",t),i(_),e.to.next(t)}function i(t,n){var e;if(!t.stop&&!(!t.err&&0<--t.stun)&&(t.stop=1,!!(e=t.root))){var l=t.match;l.end=1,l===e.hatch&&(!(l=t.latch)||l.end?delete e.hatch:e.hatch=l),t.hatch&&t.hatch(),setTimeout.each(t.match,function(T){T&&T()}),!(!(n=t.msg)||t.err||n.err)&&(n.out=y,t.root.on("out",n),q())}}function f(t){var n=t["@"]||"",e,l,T;if(!(e=n._)){var _=(_=t.$)&&(_=_._)&&(_=_.root)&&(_=_.dup);if(!(_=_.check(n)))return;t["@"]=_["#"]||t["@"];return}e.acks=(e.acks||0)+1,(e.err=t.err)&&(t["@"]=e["#"],i(e)),e.ok=t.ok||e.ok,!e.stop&&!e.crack&&(e.crack=e.match&&e.match.push(function(){p(e)})),p(e)}function p(t){!t||!t.root||t.stun||t.acks!==t.all||t.root.on("in",{"@":t["#"],err:t.err,ok:t.err?r:t.ok||{"":1}})}var s="Error: Invalid graph!",w=function(t){return" '"+(""+t).slice(0,9)+"...' "},v=JSON.stringify,B=2147483647,o=u.state,k=0,P,q=function(){k>999&&k/-(P-(P=+new Date))>1&&(u.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),q=function(){k=0})}}(),function(){u.on.get=function($,a){var j=a._,i=$.get,f=i["#"],p=j.graph[f],s=i["."],w=j.next||(j.next={}),v=w[f],B=$._||{},o=B.DBG=$.DBG;if(o&&(o.g=+new Date),!p)return j.on("get",$);if(s){if((typeof s!="string"||r===p[s])&&!((v||"").next||"")[s]){j.on("get",$);return}p=h({},s,O(p,s),p[s],f)}p&&y($,p),j.on("get",$)};function y($,a){var j=+new Date,i=$._||{},f=i.DBG=$.DBG,p=$["#"],s=b(9),w=Object.keys(a||"").sort(),v=((a||"")._||"")["#"],B=w.length,o=0,k=$.$._.root,P=a===k.graph[v];console.STAT&&console.STAT(j,((f||i).gk=+new Date)-j,"got keys"),a&&function q(){j=+new Date;for(var t=0,n,e={},l;t<9&&(n=w[t++]);)h(e,n,O(a,n),a[n],v);w=w.slice(t),(l={})[v]=e,e=l;var T;P&&(T=function(){},T.ram=T.faith=!0),l=w.length,console.STAT&&console.STAT(j,-(j-(j=+new Date)),"got copied some"),f&&(f.ga=+new Date),k.on("in",{"@":p,"#":s,put:e,"%":l?s=b(9):r,$:k.$,_:T,DBG:f,FOO:1}),console.STAT&&console.STAT(j,+new Date-j,"got in"),l&&setTimeout.turn(q)}(),a||k.on("in",{"@":$["#"]})}u.on.get.ack=y}(),function(){u.chain.opt=function(y){y=y||{};var $=this,a=$._,j=y.peers||y;return Object.plain(y)||(y={}),Object.plain(a.opt)||(a.opt=y),typeof j=="string"&&(j=[j]),Object.plain(a.opt.peers)||(a.opt.peers={}),j instanceof Array&&(y.peers={},j.forEach(function(i){var f={};f.id=f.url=i,y.peers[i]=a.opt.peers[i]=a.opt.peers[i]||f})),A(y,function i(f){var p=this[f];if(this&&this.hasOwnProperty(f)||typeof p=="string"||Object.empty(p)){this[f]=p;return}p&&p.constructor!==Object&&!(p instanceof Array)||A(p,i)}),a.opt.from=y,u.on("opt",a),a.opt.uuid=a.opt.uuid||function(f){return u.state().toString(36).replace(".","")+String.random(f||12)},$}}();var A=function(y,$){Object.keys(y).forEach($,y)},b=String.random,D=setTimeout.turn,x=u.valid,O=u.state.is,h=u.state.ify,r,c={},g;u.log=function(){return!u.log.off&&g.log.apply(g,arguments),[].slice.call(arguments).join(" ")},u.log.once=function(y,$,a){return(a=u.log.once)[y]=a[y]||0,a[y]++||u.log($)},typeof window<"u"&&((window.GUN=window.Gun=u).window=window);try{typeof N<"u"&&(N.exports=u)}catch{}C.exports=u,(u.window||{}).console=(u.window||{}).console||{log:function(){}},(g=console).only=function(y,$){return g.only.i&&y===g.only.i&&g.only.i++&&(g.log.apply(g,arguments)||$)},u.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(m,"./root"),m(function(C){var u=m("./root");u.chain.back=function(D,x){var O;if(D=D||1,D===-1||D===1/0)return this._.root.$;if(D===1)return(this._.back||this._).$;var h=this,r=h._;if(typeof D=="string"&&(D=D.split(".")),D instanceof Array){var c=0,g=D.length,O=r;for(c;c<g;c++)O=(O||A)[D[c]];return b!==O?x?h:O:(O=r.back)?O.$.back(D,x):void 0}if(typeof D=="function"){for(var y,O={back:r};(O=O.back)&&b===(y=D(O,x)););return y}return typeof D=="number"?(r.back||r).$.back(D-1):this};var A={},b})(m,"./back"),m(function(C){var u=m("./root");u.chain.chain=function(i){var f=this,p=f._,s=new(i||f).constructor(f),w=s._,v;return w.root=v=p.root,w.id=++v.once,w.back=f._,w.on=u.on,w.on("in",u.on.in,w),w.on("out",u.on.out,w),s};function A(i){var f,p,s=this.as,w=s.back,v=s.root,B;if(i.$||(i.$=s.$),this.to.next(i),s.err){s.on("in",{put:s.put=r,$:s.$});return}if(p=i.get){if(v.pass&&(v.pass[s.id]=s),s.lex&&Object.keys(s.lex).forEach(function(o){B[o]=s.lex[o]},B=i.get=i.get||{}),p["#"]||s.soul){if(p["#"]=p["#"]||s.soul,i["#"]||(i["#"]=c(9)),w=v.$.get(p["#"])._,p=p["."]){if(y(w.put,p)&&(B=w.ask&&w.ask[p],(w.ask||(w.ask={}))[p]=w.$.get(p)._,w.on("in",{get:p,put:{"#":w.soul,".":p,":":w.put[p],">":a(v.graph[w.soul],p)}}),B))return}else{if(B=w.ask&&w.ask[""],(w.ask||(w.ask={}))[""]=w,r!==w.put&&(w.on("in",w),B))return;i.$=w.$}return v.ask(O,i),v.on("in",i)}if(p["."])return s.get?(i={get:{".":s.get},$:s.$},(w.ask||(w.ask={}))[s.get]=i.$._,w.on("out",i)):(i={get:s.lex?i.get:{},$:s.$},w.on("out",i));if((s.ask||(s.ask={}))[""]=s,s.get)return p["."]=s.get,(w.ask||(w.ask={}))[s.get]=i.$._,w.on("out",i)}return w.on("out",i)}u.on.out=A;function b(i,f){f=f||this.as;var p=f.root,s=i.$||(i.$=f.$),w=(s||"")._||h,v=i.put||"",B=v["#"],o=v["."],k=r!==v["="]?v["="]:v[":"],P=v[">"]||-1/0,q;if(r!==i.put&&(r===v["#"]||r===v["."]||r===v[":"]&&r===v["="]||r===v[">"])){if(!g(v)){if(!(B=((v||"")._||"")["#"])){console.log("chain not yet supported for",v,"...",i,f);return}return s=f.root.$.get(B),setTimeout.each(Object.keys(v).sort(),function(t){t=="_"||r===(P=a(v,t))||f.on("in",{$:s,put:{"#":B,".":t,"=":v[t],">":P},VIA:i})})}f.on("in",{$:w.back.$,put:{"#":B=w.back.soul,".":o=w.has||w.get,"=":v,">":a(w.back.put,o)},via:i});return}(i.seen||"")[f.id]||((i.seen||(i.seen=function(){}))[f.id]=f,f!==w&&(Object.keys(i).forEach(function(t){v[t]=i[t]},v={}),v.get=f.get||v.get,!f.soul&&!f.has?v.$$$=v.$$$||f.$:w.soul&&(v.$=f.$,v.$$=v.$$||w.$),i=v),x(i,f),(f.soul||i.$$)&&P>=a(p.graph[B],o)&&((v=p.$.get(B)._).put=j(v.put,o,P,k,B)),!w.soul&&P>=a(p.graph[B],o)&&(q=(p.$.get(B)._.next||"")[o])&&(q.put=k,typeof(v=g(k))=="string"&&(q.put=p.$.get(v)._.put||k)),this.to&&this.to.next(i),f.any&&setTimeout.each(Object.keys(f.any),function(t){(t=f.any[t])&&t(i)},0,99),f.echo&&setTimeout.each(Object.keys(f.echo),function(t){(t=f.echo[t])&&t.on("in",i)},0,99),((i.$$||"")._||w).soul&&(q=f.next)&&(q=q[o])&&(v={},Object.keys(i).forEach(function(t){v[t]=i[t]}),v.$=(i.$$||i.$).get(v.get=o),delete v.$$,delete v.$$$,q.on("in",v)),D(i,f))}u.on.in=b;function D(i,f){if(f=f||this.as||i.$._,!(i.$$&&this!==u.on)&&!(!i.put||f.soul)){var p=i.put||"",s=p["="]||p[":"],o,w=f.root,v=w.$.get(p["#"]).get(p["."])._;if(typeof(s=g(s))!="string"){this===u.on&&((v.echo||(v.echo={}))[f.id]=f);return}if(!((v.echo||(v.echo={}))[f.id]&&!(w.pass||"")[f.id])){if(o=w.pass){if(o[s+f.id])return;o[s+f.id]=1}(v.echo||(v.echo={}))[f.id]=f,f.has&&(f.link=s);var B=w.$.get(v.link=s)._;(B.echo||(B.echo={}))[v.id]=v;var o=f.ask||"";(o[""]||f.lex)&&B.on("out",{get:{"#":s}}),setTimeout.each(Object.keys(o),function(k,P){!k||!(P=o[k])||P.on("out",{get:{"#":s,".":k}})},0,99)}}}u.on.link=D;function x(i,f){var p=i.put||"",s=r!==p["="]?p["="]:p[":"],w=f.root,v,B;if(r===s){if(f.soul&&r!==f.put||(B=(i.$$||i.$||"")._||"",i["@"]&&(r!==B.put||r!==f.put)))return;(v=f.link||i.linked)&&delete(w.$.get(v)._.echo||"")[f.id],f.has&&(f.link=null),f.put=r,setTimeout.each(Object.keys(f.next||""),function(o,k){(k=f.next[o])&&(v&&delete(w.$.get(v).get(o)._.echo||"")[k.id],k.on("in",{get:o,put:r,$:k.$}))},0,99);return}f.soul||i.$$||(v=g(s),B=i.$._||"",!((v===B.link||f.has&&!B.link)&&!((w.pass||"")[f.id]&&typeof v!="string"))&&(delete(B.echo||"")[f.id],x({get:f.get,put:r,$:i.$,linked:i.linked=i.linked||B.link},f)))}u.on.unlink=x;function O(i,f){var p=this.as,s=p.$._,w=s.root,v=p.get||"",B=(i.put||"")[v["#"]]||"";if(!i.put||typeof v["."]=="string"&&r===B[v["."]]){if(r!==s.put||!s.soul&&!s.has)return;s.ack=(s.ack||0)+1,s.on("in",{get:s.get,put:s.put=r,$:s.$,"@":i["@"]});return}(i._||{}).miss=1,u.on.put(i)}var h={},r,c=String.random,g=u.valid,y=function(i,f){return i&&Object.prototype.hasOwnProperty.call(i,f)},$=u.state,a=$.is,j=$.ify})(m,"./chain"),m(function(C){var u=m("./root");u.chain.get=function(r,c,g){var y,$;if(typeof r=="string"){if(r.length==0)return(y=this.chain())._.err={err:u.log("0 length key!",r)},c&&c.call(y,y._.err),y;var a=this,j=a._,i=j.next||x;(y=i[r])||(y=r&&A(r,a)),y=y&&y.$}else if(typeof r=="function"){let o=function(k,P,q){if(!o.stun&&!((d=p.pass)&&!d[s])){var t=k.$._,n=(k.$$||"")._,e=(n||t).put,l=!t.has&&!t.soul,T={},_,d;if((l||h===e)&&(e=h===((d=k.put)||"")["="]?h===(d||"")[":"]?d:d[":"]:d["="]),(_=typeof(d=u.valid(e))=="string")&&(e=h===(d=p.$.get(d)._.put)?f.not?h:e:d),!(f.not&&h===e)){if(h===f.stun){if((d=p.stun)&&d.on&&(j.$.back(function(G){if(d.on(""+G.id,T={}),(T.run||0)<o.id)return T}),!T.run&&d.on(""+t.id,T={}),!T.run&&n&&d.on(""+n.id,T={}),o.id>T.run&&((!T.stun||T.stun.end)&&(T.stun=d.on("stun"),T.stun=T.stun&&T.stun.last),T.stun&&!T.stun.end))){(T.stun.add||(T.stun.add={}))[s]=function(){o(k,P,1)};return}if(h===e&&(q=0),(d=p.hatch)&&!d.end&&h===f.hatch&&!q){if(w[t.$._.id])return;w[t.$._.id]=1,d.push(function(){o(k,P,1)});return}w={}}if(p.pass){if(p.pass[s+t.id])return;p.pass[s+t.id]=1}if(f.on){f.ok.call(t.$,e,t.get,k,P||o);return}if(f.v2020){f.ok(k,P||o);return}Object.keys(k).forEach(function(G){d[G]=k[G]},d={}),k=d,k.put=e,f.ok.call(f.as,k,P||o)}}};var v=o;if(c===!0)return b(this,r,c,g),this;y=this;var j=y._,f=c||{},p=j.root,s;f.at=j,f.ok=r;var w={};return o.at=j,(j.any||(j.any={}))[s=String.random(7)]=o,o.off=function(){o.stun=1,j.any&&delete j.any[s]},o.rid=D,o.id=f.run||++p.once,$=p.pass,(p.pass={})[s]=1,f.out=f.out||{get:{}},j.on("out",f.out),p.pass=$,y}else{if(typeof r=="number")return this.get(""+r,c,g);if(typeof($=O(r))=="string")return this.get($,c,g);($=this.get.next)&&(y=$(this,r))}return y?(c&&typeof c=="function"&&y.get(c,g),y):((y=this.chain())._.err={err:u.log("Invalid get request!",r)},c&&c.call(y,y._.err),y)};function A(r,c){var g=c._,y=g.next,$=c.chain(),a=$._;return y||(y=g.next={}),y[a.get=r]=a,c===g.root.$?a.soul=r:(g.soul||g.has)&&(a.has=r),a}function b(r,c,g,y){var $=r._,a=0,j;return(j=$.soul||$.link)?c(j,y,$):$.jam?$.jam.push([c,y]):($.jam=[[c,y]],r.get(function(f,p){if(!(h===f.put&&!$.root.opt.super&&(j=Object.keys($.root.opt.peers).length)&&++a<=j)){p.rid(f);var s=(s=f.$)&&s._||{},w=0,v;for(j=$.jam,delete $.jam;v=j[w++];){var B=v[0],o;v=v[1],B&&B(o=s.link||s.soul||u.valid(f.put)||((f.put||{})._||{})["#"],v,f,p)}}},{out:{get:{".":!0}}}),r)}function D(r){var c=this.at||this.on;if(!r||c.soul||c.has)return this.off();if(r=(r=(r=r.$||r)._||r).id){var g=c.map,y,$;if(y=($=this.seen||(this.seen={}))[r])return!0;$[r]=!0}}var x={},O=u.valid,h})(m,"./get"),m(function(C){var u=m("./root");u.chain.put=function(a,j,i){var f=this,p=f._,s=p.root;i=i||{},i.root=p.root,i.run||(i.run=s.once),A(i,p.id),i.ack=i.ack||j,i.via=i.via||f,i.data=i.data||a,i.soul||(i.soul=p.soul||typeof j=="string"&&j);var w=i.state=i.state||u.state();return typeof a=="function"?(a(function(v){i.data=v,f.put(O,O,i)}),f):i.soul?(i.$=s.$.get(i.soul),i.todo=[{it:i.data,ref:i.$}],i.turn=i.turn||c,i.ran=i.ran||b,function v(){var B=i.todo,o=B.pop(),k=o.it,P=o.ref&&o.ref._.id,q,t,n,e,l;if(A(i,o.ref),(e=o.todo)&&(t=e.pop(),k=k[t],e.length&&B.push(o)),t&&(B.path||(B.path=[])).push(t),!(q=g(k))&&!(l=u.is(k))){if(!Object.plain(k)){b.err(i,"Invalid data: "+x(k)+" at "+(i.via.back(function(I){I.get&&e.push(I.get)},e=[])||e.join("."))+"."+(B.path||[]).join("."));return}for(var T=i.seen||(i.seen=[]),_=T.length;_--;)if(k===(e=T[_]).it){q=k=e.link;break}}if(t&&q)o.node=y(o.node,t,w,k);else{let I=function(E,S){var M=n.link["#"];S&&(S.off(),S.rid(E));var J=M||E.soul||(e=(E.$$||E.$)._||"").soul||e.link||((e=e.put||"")._||"")["#"]||e["#"]||((e=E.put||"")&&E.$$?e["#"]:(e["="]||e[":"]||"")["#"]);if(!M&&A(i,E.$),!J&&!o.link["#"]){(o.wait||(o.wait=[])).push(function(){I(E,S)});return}J||(J=[],(E.$$||E.$).back(function(W){if(e=W.soul||W.link)return J.push(e);J.push(W.get)}),J=J.reverse().join("/")),n.link["#"]=J,!l&&(((i.graph||(i.graph={}))[J]=n.node||(n.node={_:{}}))._["#"]=J),delete i.wait[d],n.wait&&setTimeout.each(n.wait,function(W){W&&W()}),i.ran(i)};var G=I;if(!i.seen){b.err(i,"Data at root of graph must be a node (an object).");return}i.seen.push(n={it:k,link:{},todo:l?[]:Object.keys(k).sort().reverse(),path:(B.path||[]).slice(),up:o}),o.node=y(o.node,t,w,n.link),!l&&n.todo.length&&B.push(n);var d=i.seen.length;(i.wait||(i.wait={}))[d]="",e=(n.ref=l?k:t?o.ref.get(t):o.ref)._,(e=k&&(k._||"")["#"]||e.soul||e.link)?I({soul:e}):n.ref.get(I,{run:i.run,v2020:1,out:{get:{".":" "}}})}if(!B.length)return i.ran(i);i.turn(v)}(),f):(D(i),f)};function A(a,j){if(j){j=(j._||"").id||j;var i=a.root.stun||(a.root.stun={on:u.on}),f={},p;a.stun||(a.stun=i.on("stun",function(){})),(p=i.on(""+j))&&p.the.last.next(f),!(f.run>=a.run)&&i.on(""+j,function(s){if(a.stun.end){this.off(),this.to.next(s);return}s.run=s.run||a.run,s.stun=s.stun||a.stun})}}function b(a){if(a.err){b.end(a.stun,a.root);return}if(!(a.todo.length||a.end||!Object.empty(a.wait))){a.end=1;var j=a.$.back(-1)._,i=j.root,f=j.ask(function(v){i.on("ack",v),v.err&&!v.lack&&u.log(v),++p>(a.acks||0)&&this.off(),a.ack&&a.ack(v,this)},a.opt),p=0,s=a.stun,w;(w=function(){s&&(b.end(s,i),setTimeout.each(Object.keys(s=s.add||""),function(v){(v=s[v])&&v()}))}).hatch=w,a.ack&&!a.ok&&(a.ok=a.acks||9),a.via._.on("out",{put:a.out=a.graph,ok:a.ok&&{"@":a.ok+1},opt:a.opt,"#":f,_:w})}}b.end=function(a,j){a.end=r,a.the.to===a&&a===a.the.last&&delete j.stun,a.off()},b.err=function(a,j){(a.ack||r).call(a,a.out={err:a.err=u.log(j)}),a.ran(a)};function D(a){var j=a.via._,i;a.via=a.via.back(function(f){if(f.soul||!f.get)return f.$;i=a.data,(a.data={})[f.get]=i}),(!a.via||!a.via._.soul)&&(a.via=j.root.$.get(((a.data||"")._||"")["#"]||j.$.back("opt.uuid")())),a.via.put(a.data,a.ack,a)}function x(a,j){return a&&(j=a.constructor)&&j.name||typeof a}var O,h={},r=function(){},c=setTimeout.turn,g=u.valid,y=u.state.ify,$=function(a,j){a.call(j||h)}})(m,"./put"),m(function(C){var u=m("./root");m("./chain"),m("./back"),m("./put"),m("./get"),C.exports=u})(m,"./index"),m(function(C){var u=m("./index");u.chain.on=function(O,h,r,c){var g=this,y=g._,$=y.root,a,j,i,f;if(typeof O=="string")return h?(a=y.on(O,h,r||y,c),r&&r.$&&(r.subs||(r.subs=[])).push(a),g):y.on(O);var p=h;(p=p===!0?{change:!0}:p||{}).not=1,p.on=1;var s={};return g.get(O,p),g},u.chain.once=function(O,h){if(h=h||{},!O)return A(this,h);var r=this,c=r._,g=c.root,y=c.put,$=String.random(7),a,j;return r.get(function(i,f,p,s){var w=this,v=w._,B=v.one||(v.one={});if(s.stun||B[$]==="")return;if((j=u.valid(i))===!0){o();return}if(typeof j=="string")return;clearTimeout((c.one||"")[$]),clearTimeout(B[$]),B[$]=setTimeout(o,h.wait||99);function o(k){if(!v.has&&!v.soul&&(v={put:i,get:f}),x===(j=v.put)&&(j=((p.$$||"")._||"").put),typeof u.valid(j)=="string"&&(j=g.$.get(j)._.put,j===x&&!k)){B[$]=setTimeout(function(){o(1)},h.wait||99);return}s.stun||B[$]!==""&&(B[$]="",(c.soul||c.has)&&s.off(),O.call(w,j,v.get),clearTimeout(B[$]))}},{on:1}),r};function A(O,h,r){return u.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(r=O.chain())._.nix=O.once(function(c,g){r._.on("in",this._)}),r._.lex=O._.lex,r}u.chain.off=function(){var O=this,h=O._,r,c=h.back;if(c)return h.ack=0,(r=c.next)&&r[h.get]&&delete r[h.get],(r=c.any)&&(delete c.any,c.any={}),(r=c.ask)&&delete r[h.get],(r=c.put)&&delete r[h.get],(r=h.soul)&&delete c.root.graph[r],(r=h.map)&&Object.keys(r).forEach(function(g,y){y=r[g],y.link&&c.root.$.get(y.link).off()}),(r=h.next)&&Object.keys(r).forEach(function(g,y){y=r[g],y.$.off()}),h.on("off",{}),O};var b={},D=function(){},x})(m,"./on"),m(function(C){var u=m("./index"),A=u.chain.get.next;u.chain.get.next=function(h,r){var c;return Object.plain(r)?(c=((c=r["#"])||"")["="]||c)?h.get(c):((c=h.chain()._).lex=r,h.on("in",function(g){String.match(g.get||(g.put||"")["."],r["."]||r["#"]||r)&&c.on("in",g),this.to.next(g)}),c.$):(A||D)(h,r)},u.chain.map=function(h,r,c){var g=this,y=g._,$,a;return Object.plain(h)&&($=h["."]?h:{".":h},h=O),h?(u.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=g.chain(),g.map().on(function(j,i,f,p){var s=(h||D).call(this,j,i,f,p);if(O!==s){if(j===s)return a._.on("in",f);if(u.is(s))return a._.on("in",s._);var w={};Object.keys(f.put).forEach(function(v){w[v]=f.put[v]},w),w["="]=s,a._.on("in",{get:i,put:w})}}),a):((a=y.each)||((y.each=a=g.chain())._.lex=$||a._.lex||y.lex,a._.nix=g.back("nix"),g.on("in",b,a._)),a)};function b(h){this.to.next(h);var r=this.as,c=h.$,g=c._,y=h.put,$;!g.soul&&!h.$$||($=r.lex)&&!String.match(h.get||(y||"")["."],$["."]||$["#"]||$)||u.on.link(h,r)}var D=function(){},x={stun:D,off:D},O})(m,"./map"),m(function(C){var u=m("./index");u.chain.set=function(A,b,D){var x=this,O=x.back(-1),h,r;return b=b||function(){},D=D||{},D.item=D.item||A,(h=((A||"")._||"")["#"])&&((A={})["#"]=h),typeof(r=u.valid(A))=="string"?x.get(h=r).put(A,b,D):u.is(A)?(x.put(function(c){A.get(function(g,y,$){if(!g)return b.call(x,{err:u.log('Only a node can be linked! Not "'+$.put+'"!')});(r={})[g]={"#":g},c(r)},!0)}),A):(Object.plain(A)&&(A=O.get(h=x.back("opt.uuid")()).put(A)),x.get(h||O.back("opt.uuid")(7)).put(A,b,D))}})(m,"./set"),m(function(C){m("./shim");var u=function(){},A=JSON.parseAsync||function(r,c,g){var y,$=+new Date;try{c(y,JSON.parse(r,g),b.sucks(+new Date-$))}catch(a){c(a)}},b=JSON.stringifyAsync||function(r,c,g,y){var $,a=+new Date;try{c($,JSON.stringify(r,g,y),b.sucks(+new Date-a))}catch(j){c(j)}};b.sucks=function(r){r>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),b.sucks=u)};function D(r){var c=function(){},g=r.opt||{};g.log=g.log||console.log,g.gap=g.gap||g.wait||0,g.max=g.max||(g.memory?g.memory*999*999:3e8)*.3,g.pack=g.pack||g.max*.01*.01,g.puff=g.puff||9;var y=setTimeout.turn||setTimeout,$=r.dup,a=$.check,j=$.track,i=+new Date,f=i,p=c.hear=function(o,k){if(o){if(g.max<=o.length)return c.say({dam:"!",err:"Message too big!"},k);c===this&&(p.d+=o.length||0,++p.c);var P=k.SH=+new Date,q=o[0],t;if(q==="["){A(o,function(n,e){if(n||!e)return c.say({dam:"!",err:"DAM JSON parse error."},k);console.STAT&&console.STAT(+new Date,e.length,"# on hear batch");var l=g.puff;(function T(){for(var _=+new Date,d=0,G;d<l&&(G=e[d++]);)c.hear(G,k);e=e.slice(d),console.STAT&&console.STAT(_,+new Date-_,"hear loop"),w(k),e.length&&y(T,0)})()}),o="";return}if(q==="{"||(o["#"]||Object.plain(o))&&(t=o)){if(t)return p.one(t,k,P);A(o,function(n,e){if(n||!e)return c.say({dam:"!",err:"DAM JSON parse error."},k);p.one(e,k,P)});return}}};p.one=function(o,k,T){var q,t,n,e,l;if(o.DBG&&(o.DBG=l={DBG:o.DBG}),l&&(l.h=T),l&&(l.hp=+new Date),(q=o["#"])||(q=o["#"]=String.random(9)),!(n=a(q))&&(t=o["##"],!(t&&(n=o["@"]||o.get&&q)&&$.check(e=n+t)))){if((o._=function(){}).via=c.leap=k,(n=o["><"])&&typeof n=="string"&&n.slice(0,99).split(",").forEach(function(_){this[_]=1},o._.yo={}),n=o.dam){(n=c.hear[n])&&n(o,k,r),j(q);return}(n=o.ok)&&(o._.near=n["/"]);var T=+new Date;l&&(l.is=T),k.SI=q,j.ed=function(_){q===_&&(j.ed=0,(_=$.s[q])&&(_.via=k,o.get&&(_.it=o)))},r.on("in",c.last=o),l&&(l.hd=+new Date),console.STAT&&console.STAT(T,+new Date-T,o.get?"msg get":o.put?"msg put":"msg"),j(q),e&&j(e),c.leap=c.last=null}};var s=function(o,k,P){P(o,!0)};p.c=p.d=0,function(){var o=0,k;c.hash=function(n,e){var l,T,_,d=+new Date;b(n.put,function G(I,E){var S=(T||(T=_=E||"")).slice(0,32768);if(l=String.hash(S,l),T=T.slice(32768),T){y(G,0);return}console.STAT&&console.STAT(d,+new Date-d,"say json+hash"),n._.$put=_,n["##"]=l,c.say(n,e),delete n._.$put},P)};function P(n,e){var l;return e instanceof Object?(Object.keys(e).sort().forEach(q,{to:l={},on:e}),l):e}function q(n){this.to[n]=this.on[n]}var t=c.say=function(n,e){var l;if((l=this)&&(l=l.to)&&l.next&&l.next(n),!n)return!1;var T,_,d,G=n["@"],I=n._||(n._=function(){}),E=n.DBG,S=+new Date;if(I.y=I.y||S,e||E&&(E.y=S),(T=n["#"])||(T=n["#"]=String.random(9)),!k&&j(T),!(_=n["##"])&&h!==n.put&&!I.via&&G){c.hash(n,e);return}if(!e&&G&&(e=(l=$.s[G])&&(l.via||(l=l.it)&&(l=l._)&&l.via)||(l=c.last)&&G===l["#"]&&c.leap),!e&&G)return $.s[G]?void 0:(console.STAT&&console.STAT(+new Date,++o,"total no peer to ack to"),!1);if(G&&!n.put&&!_&&(($.s[G]||"").it||"")["##"])return!1;if(!e&&c.way)return c.way(n);if(E&&(E.yh=+new Date),!(d=I.raw)){c.raw(n,e);return}if(E&&(E.yr=+new Date),!e||!e.id){if(!Object.plain(e||g.peers))return!1;var S=+new Date,M=g.puff,J=g.peers,W=Object.keys(e||g.peers||{});console.STAT&&console.STAT(S,+new Date-S,"peer keys"),function R(){var F=+new Date;k=1;var U=I.raw;I.raw=d;for(var K=0,z;K<9&&(z=(W||"")[K++]);)(z=J[z]||(e||"")[z])&&c.say(n,z);I.raw=U,k=0,W=W.slice(K),console.STAT&&console.STAT(F,+new Date-F,"say loop"),W.length&&(y(R,0),G&&j(G))}();return}if(!e.wire&&c.wire&&c.wire(e),T!==e.last){if(e.last=T,e===I.via||(l=I.yo)&&(l[e.url]||l[e.pid]||l[e.id]))return!1;if(console.STAT&&console.STAT(S,((E||I).yp=+new Date)-(I.y||S),"say prep"),!k&&G&&j(G),e.batch){if(e.tail=(l=e.tail||0)+d.length,e.tail<=g.pack){e.batch+=(l?",":"")+d;return}w(e)}e.batch="[";var H=+new Date;setTimeout(function(){console.STAT&&console.STAT(H,+new Date-H,"0ms TO"),w(e)},g.gap),v(d,e),console.STAT&&G===e.SI&&console.STAT(S,+new Date-e.SH,"say ack")}};c.say.c=c.say.d=0,c.raw=function(n,e){if(!n)return"";var l=n._||{},T,_;if(_=l.raw)return _;if(typeof n=="string")return n;var d=n["##"],G=n["@"];if(d&&G){if(!l.via&&a(G+d))return!1;if(_=($.s[G]||"").it){if(d===_["##"])return!1;_["##"]||(_["##"]=d)}}if(!n.dam&&!n["@"]){var I=0,E=[];_=g.peers;for(var S in _){var M=_[S];if(E.push(M.url||M.pid||M.id),++I>6)break}I>1&&(n["><"]=E.join())}if(n.put&&(_=n.ok)&&(n.ok={"@":(_["@"]||1)-1,"/":_["/"]==n._.near?c.near:_["/"]}),T=l.$put){_={},Object.keys(n).forEach(function(W){_[W]=n[W]}),_.put=":])([:",b(_,function(W,H){if(!W){var L=+new Date;_=H.indexOf('"put":":])([:"'),J(h,H=H.slice(0,_+6)+T+H.slice(_+14)),console.STAT&&console.STAT(L,+new Date-L,"say slice")}});return}b(n,J);function J(W,H){W||(l.raw=H,c.say(n,e))}}}();function w(o){var k=o.batch,P=typeof k=="string",q;if(P&&(k+="]"),o.batch=o.tail=null,!!k&&!(P?3>k.length:!k.length)){if(!P)try{k=k.length===1?k[0]:JSON.stringify(k)}catch(t){return g.log("DAM JSON stringify error",t)}k&&v(k,o)}}function v(o,k){try{var P=k.wire;k.say?k.say(o):P.send&&P.send(o),c.say.d+=o.length||0,++c.say.c}catch{(k.queue=k.queue||[]).push(o)}}c.near=0,c.hi=function(o){var k=o.wire,P;if(!k){c.wire(o.length&&{url:o,id:o}||o);return}o.id?g.peers[o.url||o.id]=o:(P=o.id=o.id||o.url||String.random(9),c.say({dam:"?",pid:r.opt.pid},g.peers[P]=o),delete $.s[o.last]),o.met||(c.near++,o.met=+new Date,r.on("hi",o)),P=o.queue,o.queue=[],setTimeout.each(P||[],function(q){v(q,o)},0,9)},c.bye=function(o){o.met&&--c.near,delete o.met,r.on("bye",o);var k=+new Date;k=k-(o.met||k),c.bye.time=((c.bye.time||k)+k)/2},c.hear["!"]=function(o,k){g.log("Error:",o.err)},c.hear["?"]=function(o,k){o.pid&&(k.pid||(k.pid=o.pid),o["@"])||(c.say({dam:"?",pid:g.pid,"@":o["#"]},k),delete $.s[k.last])},c.hear.mob=function(o,k){if(o.peers){var P=Object.keys(o.peers),q=P[Math.random()*P.length>>0];q&&(c.bye(k),c.hi(q))}},r.on("create",function(o){o.opt.pid=o.opt.pid||String.random(9),this.to.next(o),o.on("out",c.say)}),r.on("bye",function(o,k){o=g.peers[o.id||o]||o,this.to.next(o),o.bye?o.bye():(k=o.wire)&&k.close&&k.close(),delete g.peers[o.id],o.wire=null});var B={};return r.on("bye",function(o,k){this.to.next(o),(k=console.STAT)&&(k.peers=c.near),(k=o.url)&&(B[k]=!0,setTimeout(function(){delete B[k]},g.lack||9e3))}),r.on("hi",function(o,k){if(this.to.next(o),(k=console.STAT)&&(k.peers=c.near),!g.super){var P=Object.keys(r.next||"");P.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(P,function(q){var t=r.next[q];if(g.super||(t.ask||"")[""]){c.say({get:{"#":q}},o);return}setTimeout.each(Object.keys(t.ask||""),function(n){n&&c.say({"##":String.hash((r.graph[q]||"")[n]),get:{"#":q,".":n}},o)})})}}),c}var x={},O=!0,h;try{C.exports=D}catch{}})(m,"./mesh"),m(function(C){var u=m("./index");u.Mesh=m("./mesh"),u.on("opt",function(D){if(this.to.next(D),D.once)return;var x=D.opt;if(x.WebSocket===!1)return;var O=u.window||{},h=x.WebSocket||O.WebSocket||O.webkitWebSocket||O.mozWebSocket;if(!h)return;x.WebSocket=h;var r=x.mesh=x.mesh||u.Mesh(D),c=r.wire||x.wire;r.wire=x.wire=g;function g(j){try{if(!j||!j.url)return f&&f(j);var i=j.url.replace(/^http/,"ws"),f=j.wire=new x.WebSocket(i);return f.onclose=function(){$(j),x.mesh.bye(j)},f.onerror=function(p){$(j)},f.onopen=function(){x.mesh.hi(j)},f.onmessage=function(p){p&&x.mesh.hear(p.data||p,j)},f}catch{x.mesh.bye(j)}}setTimeout(function(){!x.super&&D.on("out",{dam:"hi"})},1);var y=2*999;function $(j){clearTimeout(j.defer),x.peers[j.url]&&(a&&j.retry<=0||(j.retry=(j.retry||x.retry+1||60)-(-j.tried+(j.tried=+new Date)<y*4?1:0),j.defer=setTimeout(function i(){if(a&&a.hidden)return setTimeout(i,y);g(j)},y)))}var a=""+b!=typeof document&&document});var A=function(){},b})(m,"./websocket"),m(function(C){if(!(typeof Gun>"u")){var u=function(){},A,b;try{A=(Gun.window||u).localStorage}catch{}A||(Gun.log("Warning: No localStorage exists to persist data to!"),A={setItem:function(O,h){this[O]=h},removeItem:function(O){delete this[O]},getItem:function(O){return this[O]}});var D=JSON.parseAsync||function(O,h,r){var c;try{h(c,JSON.parse(O,r))}catch(g){h(g)}},x=JSON.stringifyAsync||function(O,h,r,c){var g;try{h(g,JSON.stringify(O,r,c))}catch(y){h(y)}};Gun.on("create",function O(h){this.to.next(h);var r=h.opt,c=h.graph,g=[],y,$,a,j;if(r.localStorage===!1)return;r.prefix=r.file||"gun/";try{y=O[r.prefix]=O[r.prefix]||JSON.parse(a=A.getItem(r.prefix))||{}}catch{y=O[r.prefix]={}}a=(a||"").length,h.on("get",function(f){this.to.next(f);var p=f.get,s,w,v,B;!p||!(s=p["#"])||(w=y[s]||B,w&&(v=p["."])&&!Object.plain(v)&&(w=Gun.state.ify({},v,Gun.state.is(w,v),w[v],s)),Gun.on.get.ack(f,w))}),h.on("put",function(f){this.to.next(f);var p=f.put,s=p["#"],w=p["."],v=f["#"],B=f.ok||"",o;if(y[s]=Gun.state.ify(y[s],w,p[">"],p[":"],s),j&&a>4999880){h.on("in",{"@":v,err:"localStorage max!"});return}!f["@"]&&(!f._.via||Math.random()<B["@"]/B["/"])&&g.push(v),!$&&($=setTimeout(i,9+a/333))});function i(){if(!g.length&&((setTimeout.turn||"").s||"").length){setTimeout(i,99);return}var f,p=g;clearTimeout($),$=!1,g=[],x(y,function(s,w){try{!s&&A.setItem(r.prefix,w)}catch(v){s=j=v||"localStorage failure"}s&&(Gun.log(s+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),h.on("localStorage:error",{err:s,get:r.prefix,put:y})),a=w.length,setTimeout.each(p,function(v){h.on("in",{"@":v,err:s,ok:0})},0,99)})}})}})(m,"./localStorage")})();(function(){var q;if(""+q!=typeof Gun){var m=function(t){console.warn("Warning! Deprecated internal utility will break in next version:",t)},N=Gun;N.fn=N.fn||{is:function(t){return m("fn"),!!t&&typeof t=="function"}},N.bi=N.bi||{is:function(t){return m("bi"),t instanceof Boolean||typeof t=="boolean"}},N.num=N.num||{is:function(t){return m("num"),!C(t)&&(t-parseFloat(t)+1>=0||t===1/0||t===-1/0)}},N.text=N.text||{is:function(t){return m("text"),typeof t=="string"}},N.text.ify=N.text.ify||function(t){return m("text.ify"),N.text.is(t)?t:typeof JSON<"u"?JSON.stringify(t):t&&t.toString?t.toString():t},N.text.random=N.text.random||function(t,n){m("text.random");var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},N.text.match=N.text.match||function(t,n){var e,l;return m("text.match"),typeof t!="string"?!1:(typeof n=="string"&&(n={"=":n}),n=n||{},e=n["="]||n["*"]||n[">"]||n["<"],t===e?!0:l!==n["="]?!1:(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e?!0:l!==n["*"]?!1:l!==n[">"]&&l!==n["<"]?t>=n[">"]&&t<=n["<"]:l!==n[">"]&&t>=n[">"]||l!==n["<"]&&t<=n["<"]))},N.text.hash=N.text.hash||function(t,n){if(m("text.hash"),typeof t=="string"){if(n=n||0,!t.length)return n;for(var e=0,l=t.length,T;e<l;++e)T=t.charCodeAt(e),n=(n<<5)-n+T,n|=0;return n}},N.list=N.list||{is:function(t){return m("list"),t instanceof Array}},N.list.slit=N.list.slit||Array.prototype.slice,N.list.sort=N.list.sort||function(t){return m("list.sort"),function(n,e){return!n||!e?0:(n=n[t],e=e[t],n<e?-1:n>e?1:0)}},N.list.map=N.list.map||function(t,n,e){return m("list.map"),k(t,n,e)},N.list.index=1,N.obj=N.boj||{is:function(t){return m("obj"),t?t instanceof Object&&t.constructor===Object||Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},N.obj.put=N.obj.put||function(t,n,e){return m("obj.put"),(t||{})[n]=e,t},N.obj.has=N.obj.has||function(t,n){return m("obj.has"),t&&Object.prototype.hasOwnProperty.call(t,n)},N.obj.del=N.obj.del||function(t,n){if(m("obj.del"),!!t)return t[n]=null,delete t[n],t},N.obj.as=N.obj.as||function(t,n,e,l){return m("obj.as"),t[n]=t[n]||(l===e?{}:e)},N.obj.ify=N.obj.ify||function(t){if(m("obj.ify"),s(t))return t;try{t=JSON.parse(t)}catch{t={}}return t},function(){var t;function n(e,l){v(this,l)&&t!==this[l]||(this[l]=e)}N.obj.to=N.obj.to||function(e,l){return m("obj.to"),l=l||{},k(e,n,l),l}}(),N.obj.copy=N.obj.copy||function(t){return m("obj.copy"),t&&JSON.parse(JSON.stringify(t))},function(){function t(n,e){var l=this.n,T;if(!(l&&(e===l||s(l)&&v(l,e)))&&T!==e)return!0}N.obj.empty=N.obj.empty||function(n,e){return m("obj.empty"),n?!k(n,t,{n:e}):!0}}(),function(){function t(T,_){if(arguments.length===2){t.r=t.r||{},t.r[T]=_;return}t.r=t.r||[],t.r.push(T)}var n=Object.keys,e,l;Object.keys=Object.keys||function(T){return e(T,function(_,d,G){G(d)})},N.obj.map=e=N.obj.map||function(T,_,d){m("obj.map");var G,I=0,E,S,M,J,W=typeof _=="function";if(t.r=G,n&&s(T)&&(M=n(T),J=!0),d=d||{},C(T)||M)for(E=(M||T).length;I<E;I++){var H=I+N.list.index;if(W){if(S=J?_.call(d,T[M[I]],M[I],t):_.call(d,T[I],H,t),S!==G)return S}else if(_===T[J?M[I]:I])return M?M[I]:H}else for(I in T)if(W){if(v(T,I)&&(S=d?_.call(d,T[I],I,t):_(T[I],I,t),S!==G))return S}else if(_===T[I])return I;return W?t.r:N.list.index?0:-1}}(),N.time=N.time||{},N.time.is=N.time.is||function(t){return m("time"),t?t instanceof Date:+new Date().getTime()};var f=N.fn.is,C=N.list.is,p=N.obj,s=p.is,v=p.has,k=p.map,u={};u.is=function(t){return m("val.is"),t===q?!1:t===null?!0:t===1/0?!1:D(t)||b(t)||$(t)?!0:u.link.is(t)||!1},u.link=u.rel={_:"#"},function(){u.link.is=function(n){if(m("val.link.is"),n&&n[A]&&!n._&&s(n)){var e={};if(k(n,t,e),e.id)return e.id}return!1};function t(n,e){var l=this;if(l.id)return l.id=!1;if(e==A&&D(n))l.id=n;else return l.id=!1}}(),u.link.ify=function(t){return m("val.link.ify"),o({},A,t)},N.obj.has._=".";var A=u.link._,q,b=N.bi.is,$=N.num.is,D=N.text.is,p=N.obj,s=p.is,o=p.put,k=p.map;N.val=N.val||u;var x={_:"_"};x.soul=function(t,n){return m("node.soul"),t&&t._&&t._[n||r]},x.soul.ify=function(t,n){return m("node.soul.ify"),n=typeof n=="string"?{soul:n}:n||{},t=t||{},t._=t._||{},t._[r]=n.soul||t._[r]||h(),t},x.soul._=u.link._,function(){x.is=function(n,e,l){m("node.is");var T;return s(n)&&(T=x.soul(n))?!k(n,t,{as:l,cb:e,s:T,n}):!1};function t(n,e){if(e!==x._){if(!u.is(n))return!0;this.cb&&this.cb.call(this.as,n,e,this.n,this.s)}}}(),function(){x.ify=function(n,e,l){return m("node.ify"),e?typeof e=="string"?e={soul:e}:typeof e=="function"&&(e={map:e}):e={},e.map&&(e.node=e.map.call(l,n,q,e.node||{})),(e.node=x.soul.ify(e.node||{},e))&&k(n,t,{o:e,as:l}),e.node};function t(n,e){var l=this.o,T,_;if(l.map){T=l.map.call(this.as,n,""+e,l.node),_===T?w(l.node,e):l.node&&(l.node[e]=T);return}u.is(n)&&(l.node[e]=n)}}();var p=N.obj,s=p.is,w=p.del,k=p.map,O=N.text,h=O.random,r=x.soul._,q;N.node=N.node||x;var c=N.state;c.lex=function(){return m("state.lex"),c().toString(36).replace(".","")},c.to=function(t,n,e){m("state.to");var l=(t||{})[n];return s(l)&&(l=P(l)),c.ify(e,n,c.is(t,n),l,x.soul(t))},function(){c.map=function(n,e,l){m("state.map");var T,_=s(_=n||e)?_:null;return n=f(n=n||e)?n:null,_&&!n?(e=$(e)?e:c(),_[j]=_[j]||{},k(_,t,{o:_,s:e}),_):(l=l||s(e)?e:T,e=$(e)?e:c(),function(d,G,I,E){if(!n)return t.call({o:I,s:e},d,G),d;n.call(l||this||{},d,G,I,E),!(v(I,G)&&T===I[G])&&t.call({o:I,s:e},d,G)})};function t(n,e){j!==e&&c.ify(this.o,e,this.s)}}();var p=N.obj,g=p.as,v=p.has,s=p.is,k=p.map,P=p.copy,y=N.num,$=y.is,a=N.fn,f=a.is,j=x._,q,i={};(function(){i.is=function(e,l,T,_){return m("graph.is"),!e||!s(e)||B(e)?!1:!k(e,t,{cb:l,fn:T,as:_})};function t(e,l){if(!e||l!==x.soul(e)||!x.is(e,this.fn,this.as))return!0;this.cb&&(n.n=e,n.as=this.as,this.cb.call(n.as,e,l,n))}function n(e){e&&x.is(n.n,e,n.as)}})(),function(){i.ify=function(_,d,G){m("graph.ify");var I={path:[],obj:_};return d?typeof d=="string"?d={soul:d}:typeof d=="function"&&(d.map=d):d={},typeof G=="string"&&(d.soul=d.soul||G,G=q),d.soul&&(I.link=u.link.ify(d.soul)),d.shell=(G||{}).shell,d.graph=d.graph||{},d.seen=d.seen||[],d.as=d.as||G,t(d,I),d.root=I.node,d.graph};function t(_,d){var G;return(G=T(_,d))?G:(d.env=_,d.soul=e,x.ify(d.obj,n,d)&&(d.link=d.link||u.link.ify(x.soul(d.node)),d.obj!==_.shell&&(_.graph[u.link.is(d.link)]=d.node)),d)}function n(_,d,G){var I=this,E=I.env,S,M;if(x._===d&&v(_,u.link._))return G._;if(S=l(_,d,G,I,E)){if(d||(I.node=I.node||G||{},v(_,x._)&&x.soul(_)&&(I.node._=P(_._)),I.node=x.soul.ify(I.node,u.link.is(I.link)),I.link=I.link||u.link.ify(x.soul(I.node))),(M=E.map)&&(M.call(E.as||{},_,d,G,I),v(G,d))){if(_=G[d],q===_){w(G,d);return}if(!(S=l(_,d,G,I,E)))return}if(!d)return I.node;if(S===!0)return _;if(M=t(E,{obj:_,path:I.path.concat(d)}),!!M.node)return M.link}}function e(_){var d=this,G=u.link.is(d.link),I=d.env.graph;d.link=d.link||u.link.ify(_),d.link[u.link._]=_,d.node&&d.node[x._]&&(d.node[x._][u.link._]=_),v(I,G)&&(I[_]=I[G],w(I,G))}function l(_,d,G,I,E){var S;if(u.is(_))return!0;if(s(_))return 1;if(S=E.invalid)return _=S.call(E.as||{},_,d,G),l(_,d,G,I,E);E.err="Invalid value at '"+I.path.concat(d).join(".")+"'!",N.list.is(_)&&(E.err+=" Use `.set(item)` instead of an Array.")}function T(_,d){for(var G=_.seen,I=G.length,E;I--;)if(E=G[I],d.obj===E.obj)return E;G.push(d)}}(),i.node=function(t){m("graph.node");var n=x.soul(t);if(n)return o({},n,t)},function(){i.to=function(n,e,l){if(m("graph.to"),!!n){var T={};return l=l||{seen:{}},k(n[e],t,{obj:T,graph:n,opt:l}),T}};function t(n,e){var l,T;if(x._===e){if(B(n,u.link._))return;this.obj[e]=P(n);return}if(!(l=u.link.is(n))){this.obj[e]=n;return}if(T=this.opt.seen[l]){this.obj[e]=T;return}this.obj[e]=this.opt.seen[l]=i.to(this.graph,l,this.opt)}}();var f=N.fn.is,p=N.obj,s=p.is,w=p.del,v=p.has,B=p.empty,o=p.put,k=p.map,P=p.copy,q;N.graph=N.graph||i}})()});var tt=Q((rt,Z)=>{Z.exports=X()});tt();(function(){let N=document.querySelector("#list"),C=document.querySelector("#content"),u=document.querySelector("#new-note"),A=document.querySelector("#remove-note"),b=document.querySelector("#save-note"),D=document.querySelector("#change-title"),x=document.querySelector("dialog"),O=x.querySelector("#confirm-title"),h=x.querySelector("#new-title"),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=Gun().get("notes"),y=[],$=[],a=[];var j=!1;G(y),I(y),E(y);var i;i=y[0]??=P(),d(i),s(i).classList.add("active-note"),u.onclick=S=>{S.preventDefault();let M=P();y.unshift(M),N.insertAdjacentElement("afterbegin",s(M))},A.onclick=S=>{S.preventDefault();let M;for(let J=0;J<y.length;++J)if(y[J].id==i.id){M=J;break}q(i),_(i),e(i),$.push(y.splice(M,1)[0]),i=y[0]??=P(),s(i),T(i),j=!0},b.onclick=S=>{S.preventDefault(),k(i),I(y),N.insertAdjacentElement("afterbegin",s(i))},D.onclick=S=>{S.preventDefault(),x.showModal(),h.value=i.title},O.onclick=S=>{S.preventDefault(),x.close(),i.title!=h.value&&(i.modified=!0,w(i,h.value)),h.value=null};let f=B(()=>{i.content=C.innerHTML});new MutationObserver(()=>{if(f(),!i.modified){if(j){j=!1;return}i.modified=!0,s(i)}}).observe(C,{characterData:!0,subtree:!0,childList:!0});function s(S){let M=document.getElementById(S.id);M||(M=document.createElement("li"),N.insertAdjacentElement("afterbegin",M)),M.style.display="block",M.id=S.id,M.classList.add("outlined");let J=new Date(S.time),W=J.getMinutes(),H=J.getSeconds(),L=J.getHours();return M.innerHTML=`${S.modified?"*":""}${S.title}<br>${J.getFullYear()}-${r[J.getMonth()]}-${J.getDate()}<br>${L<10?"0"+L:L}:${W<10?"0"+W:W}:${H<10?"0"+H:H}`,M.onclick=()=>{_(i),T(S),i=S,j=!0},M}function w(S,M){S.title=M,s(S)}function v(S,M=300){let J=!1,W;function H(){J=!1,W&&(J=!0,S(...W),W=null,setTimeout(H,M))}return(...L)=>{W=L,!J&&(S(...L),J=!0,setTimeout(H,M))}}function B(S,M=300){let J;return(...W)=>{clearTimeout(J),J=setTimeout(()=>S(...W),M)}}function o(){return document.getSelection()}function k(S){S.time=new Date().getTime(),S.modified=!1,g.get(S.id).put(JSON.stringify(S))}function P(){let S=$.pop()??{};return S.title="New note",S.id??=a.pop()??l(),S.time=new Date().getTime(),S.content="",S.modified=!1,S}function q(S){let M=g.get(S.id);M.once(J=>J?(M.put(null),!0):!1)}function t(S,M){M.title=S.title,M.content=S.content,M.time=S.time,M.modified=S.modified}function n(S){document.getElementById(S.id).remove()}function e(S){document.getElementById(S.id).style.display="none"}function l(){return parseInt(Math.random()*2**64)}function T(S){document.getElementById(S.id).classList.add("active-note"),d(S)}function _(S){document.getElementById(S.id).classList.remove("active-note")}function d(S){C.innerHTML=S.content}function G(S){return S.splice(0),g.map().once((M,J)=>{if(M==null){a.push(J);return}S.push(JSON.parse(M))}),S}function I(S){return S.sort((M,J)=>J.time-M.time),S}function E(S){for(let M=S.length-1;M>=0;--M)s(S[M])}})();})();
